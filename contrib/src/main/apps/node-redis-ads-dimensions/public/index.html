<!--
 --  Copyright (c) 2012-2013 DataTorrent, Inc.
 --  All Rights Reserved.
 -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Data Torrent : Ads Demo </title>

    <link rel="stylesheet" type="text/css" href="css/malhar.css">
    <script src="js/vendor/jquery-1.10.2.min.js"></script>

    <!-- Google charts include -->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load('visualization', '1', {'packages':['corechart']});
    </script>

    <!-- Malhar charting utils -->
    <script type="text/javascript" src="js/global.js"></script>
    <script type="text/javascript" src="js/charts.js"></script>

    <!-- window onload -->
    <script type="text/javascript">
        //<![CDATA[
        var endTime = 1378451460000 - 60*1000*30;
        endTime = null;

        function loadCharts() {
            //var url = DataUrl();
            var parameters = {
                lookbackMinutes: 15,
                endTime: endTime
            }

            jQuery.ajax({
                url: '/data',
                data: parameters,
                success: function(data) {
                    drawCostChart(data);
                    drawRevenueChart(data);
                    drawClicksChart(data);
                    drawImpressionsChart(data);
                    drawCtrChart(data);
                    drawMarginChart(data);

                    //endTime += 60 * 1000;
                    setTimeout(loadCharts, 3000);
                }
            });
        }

        jQuery(window).load(function() {

            // Initialize global
            InitializeGlobal();

            // Inituialize form fields
            if (params['publisher']) document.getElementById('publisher').value = params['publisher'];
            if (params['advertiser']) document.getElementById('advertiser').value = params['advertiser'];
            if (params['adunit']) document.getElementById('adunit').value = params['adunit'];
            if (params['refresh'])
            {
                document.getElementById('refresh').value = params['refresh'];
            } else {
                document.getElementById('refresh').value = 5;
            }
            if (params['lookback'])
            {
                document.getElementById('lookback').value = params['lookback'];
            } else {
                document.getElementById('lookback').value = 6;
            }

            loadCharts();
        });

        jQuery(function() {
            populateSelect('#publisher', 'Publisher', 50);
            populateSelect('#advertiser', 'Advertiser', 100);
            populateSelect('#adunit', 'Ad Unit', 5);

            function populateSelect(id, value, times) {
                var select = jQuery(id);
                var html = '';
                for (var i = 0; i < times; i++) {
                    html += '<option value="$i">$value $i</option>'
                            .replace(/\$i/g, i)
                            .replace('$value', value);
                }
                select.append(html);
            }
        });

        //]]>
    </script>
</head>
<body>

<div id="header">
    <ul class="dashboard-modes">
        <li>
            <a href="#" class="active">Ads Dimensions Demo</a>
        </li>
    </ul>

    <div id="logo"><img src="img/main_banner.png"/></div>
</div>

<div id="main">
    <div id="pagecontent">
        <div class="dashboardMgr">
            <div class="inner" style="">
                <h2 class="title">View Real Time Data Charts</h2>
                <form method="GET" action="index.html">

                    <label for="publisher">Publisher ID:</label>
                    <select name="publisher" id="publisher" style="width:200px;">
                        <option value="">ALL</option>
                    </select>

                    <label for="">Advertiser ID:</label>
                    <select name="advertiser" id="advertiser" style="width:200px;">
                        <option value="">ALL</option>
                    </select>

                    <label for="">Ad Unit:</label>
                    <select name="adunit" id="adunit" style="width:200px;">
                        <option value="">ALL</option>
                    </select>

                    <label for="">Refresh Interval:</label>
                    <div class="input-append">
                        <input type="text" name="refresh" id="refresh" class="input-small"/>
                        <span class="add-on">Secs</span>
                    </div>


                    <label for="">Look Back:</label>
                    <div class="input-append">
                        <input type="text" name="lookback" id="lookback" class="input-small"/>
                        <span class="add-on">Hours</span>
                    </div>

                    <input type="submit" value="submit" class="btn btn-primary" />

                </form>
            </div>
            <div class="collapser-container">
                <div class="collapser">
                    <div class="collapse-dot"></div>
                    <div class="collapse-dot"></div>
                    <div class="collapse-dot"></div>
                </div>
            </div>
        </div>
        <div class="dashboardMain">
            <div class="chart-ctnr" id="chart_div"></div>
            <div class="chart-ctnr" id="chart1_div" ></div>
            <div class="chart-ctnr" id="chart2_div" ></div>
            <div class="chart-ctnr" id="chart3_div" ></div>
            <div class="chart-ctnr" id="chart4_div" ></div>
            <div class="chart-ctnr" id="chart5_div" ></div>
        </div>
</body>
</html>